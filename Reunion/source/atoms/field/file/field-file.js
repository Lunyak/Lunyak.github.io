import Dropzone from 'dropzone';

export default class FieldFile {
  constructor(fieldFile, eventsConfig, url) {
    if (!fieldFile) return;

    this.size = fieldFile.dataset.size;
    this.count = fieldFile.dataset.count;
    this.format = fieldFile.dataset.format;

    this.file = new Dropzone(fieldFile, {
      url,
      uploadMultiple: true,
      parallelUploads: 5,
      maxFilesize: this.size || null,
      maxFiles: this.count || null,
      paramName: 'file',
      autoProcessQueue: false,
      acceptedFiles: `application/${this.format}` || null,
      previewTemplate: `
      <div class="dz-preview dz-file-preview dz-clickable">
      <div class="dz-details">
        <div class="dz-filename"><span data-dz-name></span></div>
        <div class="dz-size" data-dz-size></div>
      </div>
      <div class="dz-wrap">
        <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
        <div class="dz-error-mark"><svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
        <path d="M15.8253 13.296L9.13466 1.55814C9.02091 1.35742 8.85595 1.19048 8.65661 1.07432C8.45728 0.95817 8.2307 0.896973 7.99999 0.896973C7.76929 0.896973 7.54271 0.95817 7.34337 1.07432C7.14404 1.19048 6.97908 1.35742 6.86533 1.55814L0.174731 13.296C0.0603197 13.4942 5.87889e-05 13.719 4.29929e-08 13.9478C-5.87029e-05 14.1766 0.0600867 14.4014 0.174397 14.5997C0.288707 14.7979 0.453158 14.9626 0.651237 15.0771C0.849316 15.1917 1.07405 15.2521 1.30287 15.2523H14.7036C14.9319 15.251 15.1558 15.1897 15.353 15.0747C15.5502 14.9597 15.7137 14.7949 15.8272 14.5969C15.9408 14.3988 16.0003 14.1745 16 13.9462C15.9997 13.7179 15.9394 13.4937 15.8253 13.296ZM1.29635 13.9481L7.99999 2.21024L14.7036 13.9481H1.29635Z" fill="#1F1C2D"/>
        <path d="M8.00025 10.6875C7.8273 10.6875 7.66144 10.7562 7.53914 10.8785C7.41685 11.0008 7.34814 11.1667 7.34814 11.3396V11.9917C7.34814 12.1647 7.41685 12.3305 7.53914 12.4528C7.66144 12.5751 7.8273 12.6438 8.00025 12.6438C8.1732 12.6438 8.33906 12.5751 8.46136 12.4528C8.58365 12.3305 8.65235 12.1647 8.65235 11.9917V11.3396C8.65235 11.1667 8.58365 11.0008 8.46136 10.8785C8.33906 10.7562 8.1732 10.6875 8.00025 10.6875Z" fill="#1F1C2D"/>
        <path d="M7.34814 5.47046V9.3831C7.34814 9.55604 7.41685 9.72191 7.53914 9.8442C7.66144 9.9665 7.8273 10.0352 8.00025 10.0352C8.1732 10.0352 8.33906 9.9665 8.46136 9.8442C8.58365 9.72191 8.65235 9.55604 8.65235 9.3831V5.47046C8.65235 5.29752 8.58365 5.13165 8.46136 5.00936C8.33906 4.88706 8.1732 4.81836 8.00025 4.81836C7.8273 4.81836 7.66144 4.88706 7.53914 5.00936C7.41685 5.13165 7.34814 5.29752 7.34814 5.47046Z" fill="#1F1C2D"/>
        </svg></div>
        <button class="dz-remove" type="button" data-dz-remove=""><svg width="15" height="15" viewBox="0 0 15 15" xmlns="http://www.w3.org/2000/svg">
        <path d="M6.81998 0C5.32374 0 4.09795 1.22965 4.09795 2.7289C2.93779 2.71601 1.81382 2.7289 0.662191 2.7289C-0.259646 2.79461 -0.191889 4.11909 0.696747 4.0926H1.3746V12.2725C1.3746 13.7718 2.60171 15 4.09795 15H10.9043C12.4006 15 13.6211 13.7718 13.6211 12.2725V4.0926H14.3042C15.2319 4.11321 15.2319 2.70828 14.3042 2.7289C13.1659 2.72686 12.0434 2.7289 10.9043 2.7289C10.9043 1.22965 9.67723 0 8.18099 0H6.81998ZM6.81998 1.36512H8.18099C8.94677 1.36512 9.54333 1.96159 9.54333 2.7289H5.45896C5.45896 1.96159 6.0542 1.36512 6.81998 1.36512ZM2.73561 4.0926H12.26V12.2725C12.26 13.0398 11.6701 13.6363 10.9043 13.6363H4.09795C3.33217 13.6363 2.73561 13.0398 2.73561 12.2725V4.0926ZM4.76517 6.12631C4.38932 6.13404 4.09058 6.44489 4.09795 6.82149V10.9074C4.11765 11.7966 5.43927 11.7966 5.45896 10.9074V6.82149C5.46655 6.43445 5.15144 6.11871 4.76517 6.12631ZM7.48852 6.12631C7.11215 6.13404 6.81261 6.44437 6.81998 6.82149V10.9074C6.79948 11.8369 8.2015 11.8369 8.18099 10.9074V6.82149C8.18855 6.43499 7.87427 6.11948 7.48852 6.12631ZM10.2105 6.12631C9.8347 6.13404 9.53596 6.44489 9.54333 6.82149V10.9074C9.56304 11.7966 10.8846 11.7966 10.9043 10.9074V6.82149C10.9119 6.43445 10.5968 6.11871 10.2105 6.12631Z" fill="#1F1C2D"/>
        </svg></button>
      </div>
    </div>`,

      init() {
        if (eventsConfig) {
          Object.keys(eventsConfig).forEach((el) => {
            this.on(`${el}`, eventsConfig[el]);
          });
        }
      },
    });
  }
}
